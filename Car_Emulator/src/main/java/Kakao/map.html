<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>CSV 차량 경로 표시 (카카오맵)</title>
    <!-- 카카오맵 JavaScript API (발급받은 JavaScript 키 넣기) -->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=add11042e2106bda0af860e997dfb97f"></script>
    <style>
        #map { width: 100%; height: 600px; }
        body { margin: 0; padding: 0; }
    </style>
</head>
<body>
<input type="file" id="fileInput" />
<div id="map"></div>

<script>
    var mapContainer = document.getElementById('map');
    var map = new kakao.maps.Map(mapContainer, {
        center: new kakao.maps.LatLng(37.566, 126.978),
        level: 5
    });

    document.getElementById('fileInput').addEventListener('change', function(e) {
        var file = e.target.files[0];
        if (!file) return;

        var reader = new FileReader();
        reader.onload = function(event) {
            var csvData = event.target.result;
            var lines = csvData.trim().split("\n");
            var coords = [];

            for (var i = 1; i < lines.length; i++) { // 첫 줄(헤더) 제외
                var cols = lines[i].split(",");
                if (cols.length < 11) continue;

                var lat = parseFloat(cols[9]) / 1_000_000;
                var lon = parseFloat(cols[10]) / 1_000_000;
                if (!isNaN(lat) && !isNaN(lon)) {
                    coords.push(new kakao.maps.LatLng(lat, lon));
                }
            }

            if (coords.length > 0) {

                map.setCenter(coords[0]);


                var polyline = new kakao.maps.Polyline({
                    path: coords,
                    strokeWeight: 5,
                    strokeColor: '#FF0000',
                    strokeOpacity: 0.8,
                    strokeStyle: 'solid'
                });
                polyline.setMap(map);


                new kakao.maps.Marker({
                    position: coords[0],
                    map: map,
                    title: "시작"
                });
                new kakao.maps.Marker({
                    position: coords[coords.length - 1],
                    map: map,
                    title: "도착"
                });


                var bounds = new kakao.maps.LatLngBounds();
                coords.forEach(p => bounds.extend(p));
                map.setBounds(bounds);
            }
        };

        reader.readAsText(file);
    });
</script>
</body>
</html>
